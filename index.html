<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Build Wikipedia Viewer</title>
</head>
<link rel="stylesheet" href="styles.css">
<body>
	<header class="group">
		<div class="logo">
			<a href="https://en.wikipedia.org/wiki/Special:Random">
				<img src="http://logodatabases.com/wp-content/uploads/2012/03/wikipedia-w-logo.png" alt="">
			</a>
		</div>
		<div class="search">
			<input type="text" class="search-input" placeholder="Seach Wikipedia">
		</div>
	</header>
	<main>
		<div id="out"></div>
	</main>
	<script
	  src="http://code.jquery.com/jquery-3.2.1.min.js"
	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	  crossorigin="anonymous">
	</script>
  <script>
  	var inputElement = document.getElementsByClassName('search-input')[0];
  	var output = document.getElementById('out');
  	inputElement.focus();
  	var ENTER_KEY = 13;

  	// https://github.com/forral/myTodoMVC/blob/master/todoApp.js#L97
		inputElement.addEventListener('keyup', function(event) {

			if (event.keyCode === ENTER_KEY) {

				output.innerHTML = '<p>Loading...</p>';

				var searchValue = inputElement.value;
				searchValue = searchValue.trim();
				inputElement.value = searchValue;

				if (searchValue.length < 1) {
					output.innerHTML = '<p>NO VALUE</p>';
					return;
				}

				// Saving search history (search keyword and date)
				userSettings.searchHistory.push({
					searchValue: searchValue, 
					date: new Date()
				});

		  	//the `&callback=?` solution was taken from this post: https://stackoverflow.com/questions/3828982/xmlhttprequest-cannot-load-an-url-with-jquery
				var urlBuild = 'https://en.wikipedia.org/w/api.php?action=opensearch&format=json&maxlag=10&search=' + searchValue + '&limit=' + userSettings.numbOfArticles + '&callback=?';

				$.getJSON(urlBuild, function(data) {
					output.innerHTML = '';

					if (data[1].length === 0) {
						output.innerHTML = '<p>NO MATCH</p>';
					}

					for (var i = 0; i < data[1].length; i++) {
						buildDivElement(data[1][i], data[3][i], data[2][i]);
					}
				});
			}
		});

		function buildDivElement(title, link, description) {
			// create a <div>
			var divElement = document.createElement('div');
			divElement.className = 'search-content';

			// create a <h2> with the title passed
			var h2Element = document.createElement('h2');
			h2Element.textContent = title;
			// append the <h2> to the <div>
			divElement.appendChild(h2Element);

			// create an <a> with the href passed has link
			var aElement = document.createElement('a');
			aElement.textContent = link;
			aElement.href = link;
			// append the <a> to the <div>
			divElement.appendChild(aElement);


			// create a <p> with the description passed
			var pElement = document.createElement('p');
			pElement.textContent = description;
			// append the <p> to the <div>
			divElement.appendChild(pElement);

			// append the div to the document.
			output.appendChild(divElement);
		}

		var userSettings = {
			numbOfArticles: 10,
			searchHistory: []
		}

  </script>
</body>
</html>